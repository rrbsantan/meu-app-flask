<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; }
    .container { background: #fff; padding: 30px; margin: 40px auto; width: 900px; border-radius: 12px; box-shadow: 0 0 18px #d1d5db; }
    .logo-box { text-align: center; margin-bottom: 18px; }
    .logo-box img { width: 80px; height: auto; border-radius: 0; box-shadow: none; }
    .logout { float: right; margin-top: 8px; }
    .calendar-box form { display: block; }
    .calendar-box label, .calendar-box input, .calendar-box select, .calendar-box button { margin-bottom: 8px; }
    .cards-grid { display: flex; flex-wrap: wrap; gap: 18px; margin-top: 20px; justify-content: center; }
        .flatpickr-day.has-arquivo {
            background: #4dd0e1 !important;
            color: #fff !important;
            border-radius: 6px !important;
        }
        .file-actions a {
            color: #1976d2;
            background: #e3f2fd;
            border-radius: 8px;
            padding: 12px 28px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.08em;
            border: 1.5px solid #90caf9;
            transition: background 0.2s;
            margin-top: 4px;
        }
        .file-card {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 2px 12px #d1d5db;
            padding: 22px 18px;
            width: 320px;
            min-height: 260px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid #1976d2;
            justify-content: flex-start;
        }
        .file-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 8px;
            text-align: center;
            letter-spacing: 1px;
            width: 100%;
        }
        .miniatura {
            width: 220px;
            height: 120px;
            border-radius: 8px;
            box-shadow: 0 1px 8px #ccc;
            object-fit: cover;
            margin-bottom: 8px;
            border: 1.5px solid #b0b8c1;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .dados-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0 18px;
            width: 100%;
            margin-bottom: 8px;
        }
        .dados-label {
            color: #1976d2;
            font-weight: bold;
            font-size: 0.98em;
            margin-bottom: 2px;
        }
        .dados-real {
            color: #1976d2;
            font-weight: bold;
        }
        .dados-plan {
            color: #d32f2f;
            font-weight: bold;
        }
        .file-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }
        .file-actions a {
            color: #1976d2;
            background: #e3f2fd;
            border-radius: 8px;
            padding: 7px 16px;
            text-decoration: none;
            font-weight: 500;
            border: 1px solid #90caf9;
            transition: background 0.2s;
        }
        .file-actions a:hover {
            background: #bbdefb;
        }
    body { font-family: Arial, sans-serif; background: #fff; }
        .container { background: #fff; padding: 30px; margin: 40px auto; width: 900px; border-radius: 12px; box-shadow: 0 0 18px #d1d5db; }
        h2 { color: #0a2a66; }
        .logout {
            position: absolute;
            top: 32px;
            right: 48px;
            font-size: 1.08em;
            color: #5e35b1;
            text-decoration: underline;
        }
        .cards-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            margin-top: 20px;
            justify-content: center;
        }
        .file-card {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 2px 12px #d1d5db;
            padding: 22px 18px;
            width: 260px;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-start;
            transition: box-shadow 0.2s;
        }
        .file-card:hover {
            box-shadow: 0 4px 18px #b0b8c1;
        }
        .file-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #0a2a66;
            margin-bottom: 8px;
        }
        .file-type {
            font-size: 0.95em;
            color: #3b82f6;
            margin-bottom: 6px;
        }
        .file-actions {
            margin-top: 10px;
        }
        .file-actions a {
            margin-right: 14px;
            color: #0a2a66;
            text-decoration: none;
            font-weight: 500;
            border-radius: 8px;
            padding: 6px 12px;
            background: #e9f1fb;
            transition: background 0.2s;
        }
        .file-actions a:hover {
            background: #dbeafe;
        }
        .file-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-box">
            <img src="{{ url_for('static', filename='Logo.png') }}" alt="Logo">
        </div>
        <a href="/logout" class="logout">Sair</a>
        <h2>Bem-vindo, {{ session['usuario'] }}!</h2>
        <p>Tipo de acesso: <strong>{{ tipo }}</strong></p>
        {% if pastas %}
        <p>Sua(s) pasta(s): <strong>{{ pastas|join(', ') }}</strong></p>
        {% else %}
        <p>Acesso administrativo: todas as pastas disponíveis.</p>
        {% endif %}
        <hr>
        <div class="calendar-box" style="margin-bottom: 18px;">
            <form method="get" action="/dashboard">
                <label for="data">Selecione a data:</label>
                <input type="text" id="data" name="data" value="{{ data }}">
                {% if tipo == 'administrativo' and coordenadores %}
                <label for="coordenador">Coordenador:</label>
                <select id="coordenador" name="coordenador">
                    <option value="">Selecione...</option>
                    {% for coord in coordenadores %}
                        <option value="{{ coord }}" {% if coord == coord_selecionado %}selected{% endif %}>{{ coord }}</option>
                    {% endfor %}
                </select>
                {% endif %}
                <button type="submit">Buscar</button>
            </form>
        </div>
            {% if arquivos %}
            <div class="files-list">
                <h3 style="margin-bottom:18px;">Vendedores do dia {{ data }}:</h3>
                <div class="cards-grid">
                {% for card in arquivos %}
                    <div class="file-card">
                        <div class="file-title" style="text-align:center;">{{ card['nome'] }}</div>
                        {% if card['miniatura'] and card['miniatura']|length > 0 %}
                            <img class="miniatura" src="{{ url_for('ver_mapa', subpath=card['miniatura']) }}" alt="Miniatura">
                        {% else %}
                            <div class="miniatura" style="background:#e9f1fb;display:flex;align-items:center;justify-content:center;color:#888;">Sem miniatura</div>
                        {% endif %}
                        <div style="width:100%;text-align:left;font-size:1em;margin-bottom:6px;">
                            <div style="display:flex;justify-content:center;align-items:center;gap:32px;margin-bottom:2px;">
                                <span style="font-weight:bold;color:#1976d2;text-align:center;min-width:80px;">Real</span>
                                <span style="font-weight:bold;color:#d32f2f;text-align:center;min-width:80px;">Planejado</span>
                            </div>
                            <div><span style="font-weight:bold;color:#222;">Distância:</span> <span style="color:#1976d2;">{{ card['dados']['dist_real'] }}</span> km / <span style="color:#d32f2f;">{{ card['dados']['dist_plan'] }}</span> km</div>
                            <div><span style="font-weight:bold;color:#222;">Custo:</span> <span style="color:#1976d2;">{{ card['dados']['custo_real'] }}</span> / <span style="color:#d32f2f;">{{ card['dados']['custo_plan'] }}</span></div>
                            <div><span style="font-weight:bold;color:#222;">Visitas:</span> <span style="color:#1976d2;">{{ card['dados']['visitas_real'] }}</span> / <span style="color:#d32f2f;">{{ card['dados']['visitas_plan'] }}</span></div>
                            <div><span style="font-weight:bold;color:#222;">Dentro/Fora:</span> <span style="color:#1976d2;">{{ card['dados']['dentro_real'] }}</span> / <span style="color:#d32f2f;">{{ card['dados']['fora_real'] }}</span></div>
                            <div><span style="font-weight:bold;color:#222;">Período:</span> <span style="color:#222;">{{ card['dados']['periodo'] }}</span></div>
                        </div>
                        <div class="file-actions" style="justify-content:center;width:100%;">
                            <a href="{{ url_for('ver_mapa', subpath=card['mapa_html']) }}" target="_blank">Mapa</a>
                            <a href="{{ url_for('baixar_arquivo', caminho=card['planilha']) }}">Plan. Real</a>
                            {% if card['planilha'] %}
                            <a href="{{ url_for('baixar_arquivo', caminho=card['planilha']) }}">Plan. Prev.</a>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var diasComArquivos = {{ dias_com_arquivos|tojson|safe }};
            var dataSelecionada = "{{ data if data else '' }}";
            var anoMes = "";
            if (dataSelecionada) {
                var partes = dataSelecionada.split('-');
                anoMes = partes[0] + '-' + partes[1];
            }
            var datasHabilitadas = diasComArquivos.map(function(d) {
                return anoMes + '-' + d;
            });
            flatpickr("#data", {
                dateFormat: "Y-m-d",
                locale: "pt",
                enable: datasHabilitadas,
                onDayCreate: function(dObj, dStr, fp, dayElem) {
                    var d = dayElem.dateObj.getDate().toString().padStart(2, '0');
                    var m = (dayElem.dateObj.getMonth()+1).toString().padStart(2, '0');
                    var y = dayElem.dateObj.getFullYear().toString();
                    if (anoMes === (y + '-' + m) && diasComArquivos.includes(d)) {
                        dayElem.classList.add('has-arquivo');
                    }
                }
            });
        });
    </script>
</body>
</html>
